### 1 架构

#### Flink Clent

客户端获取代码并转换为作业，提交给 `JobManager`



#### JobManager

作业调度，将作业转化分发给 `TaskManager`



#### TaskManager

数据处理



#### 执行流程

- 客户端执行脚本 

```shell
flink run -d -t yarn-per-job -c ... ....
```

- 客户端
  - 解析参数
  - 封装提交作业
- Yarn 分配 NodeManager -> Container
- Container 启动 JobManager
- JobManager 负责作业的解析及向 Yarn 申请资源（NodeManager -> TaskManager）
- JobManager 分发 Task 到 TaskManager 上执行
- TaskManager 上分配 Slot 进行执行
  - 每个算子根据并行度不同可以划分为多个 subtask
  - 当连续算子之间属于窄依赖且并行度相同时，可以划归为一个算子链，一个算子链考虑集群资源，可能被分发到同一个 slot 中，减少网络IO，算子链在 同一个 solt 中执行时，为了避免同步竞争，采用的是单线程串行执行，可以提高 算子链的并行度来将算子链的并行子算子链分发到不同的 solt 来提高并行度。



#### 算子链

算子链是flink 自动优化的手段，将并行度相同的窄依赖的连续算子合并成算子链，根据并行度分发到不同的 slot 执行，也就是说并行算子链的每一个算子链的算子将在 同一个 solt 中串行执行来减少IO



另外，flink 还提供了算子组的接口来声明算子属于哪一个组中，这些并行算子也会被分发到同一个 slot 中并行执行，对于连续的算子组成的算子组来说，也是并行处理，只不过是数据串行，而执行的算子是并行的。对于非连续算子的算子组，咱们最好是保证这样的算子组中是对资源的考量，比如说某个算子是IO 密集型，另外一个算子是 计算密集型，咱们就可以分到一个组中来高效利用 slot 资源，当然算子组也需要考虑并行度，最好是保证算子组中的算子的并行度一致，否则会造成复杂的 slot 划分

